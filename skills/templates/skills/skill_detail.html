{% extends 'base.html' %}
{% load markdown_extras %}

{% block title %}{{ skill.title }} | Aurora{% endblock %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <a href="{% url 'skill_list' %}" class="btn btn-outline-secondary btn-sm">‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ —Å–ø–∏—Å–∫—É</a>

        <div class="btn-group">
            <a href="{% url 'skill_edit' skill.slug %}" class="btn btn-outline-primary btn-sm">
                ‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
            </a>
            <a href="{% url 'skill_delete' skill.slug %}" class="btn btn-outline-danger btn-sm">
                üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏
            </a>
        </div>
    </div>

    <div class="row">

        <div class="col-lg-8">
            <div class="card shadow-sm mb-4">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <span class="badge bg-secondary mb-2">{{ skill.get_difficulty_display }}</span>
                            <h1 class="text-primary fw-bold mb-1">{{ skill.title }}</h1>
                            <p class="text-muted small">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è: {{ skill.category }}</p>
                        </div>
                        {% if skill.my_status == 'done' %}
                            <span class="badge bg-success fs-6">‚úÖ –í–∏–≤—á–µ–Ω–æ</span>
                        {% endif %}
                    </div>

                    {% if skill.get_video_id %}
                        <div class="ratio ratio-16x9 mb-4 shadow-sm rounded overflow-hidden bg-dark">
                            <iframe
                                src="https://www.youtube.com/embed/{{ skill.get_video_id }}?rel=0"
                                title="Video"
                                allowfullscreen>
                            </iframe>
                        </div>
                    {% endif %}

                    <hr>

                    <div class="content-area py-2">
                        {% if skill.description %}
                            {{ skill.description|markdown }}
                        {% else %}
                            <div class="alert alert-light text-center text-muted border">
                                –û–ø–∏—Å –¥–ª—è —Ü—ñ—î—ó –Ω–∞–≤–∏—á–∫–∏ —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ.
                            </div>
                        {% endif %}
                    </div>

                </div>
            </div>
        </div>

        <div class="col-lg-4">

            <div class="card shadow-sm mb-4 sticky-top" style="top: 80px; z-index: 1;"> <div class="card-header bg-white fw-bold border-bottom">
                    –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å
                </div>
                <div class="card-body text-center">
                    {% if user.is_authenticated %}

                        <div class="mb-4">
                            {% if skill.my_status == 'done' %}
                                <h2 class="text-success">üéâ –í–∏–≤—á–µ–Ω–æ</h2>
                                <p class="text-muted small">–ß—É–¥–æ–≤–∞ —Ä–æ–±–æ—Ç–∞!</p>
                            {% elif skill.my_status == 'in_progress' %}
                                <h2 class="text-warning">üî• –í –ø—Ä–æ—Ü–µ—Å—ñ</h2>
                                <p class="text-muted small">–ù–µ –∑—É–ø–∏–Ω—è–π—Å—è!</p>
                            {% elif skill.is_locked %}
                                <h2 class="text-secondary">üîí –ó–∞–∫—Ä–∏—Ç–æ</h2>
                                <p class="text-danger small">–°–ø–æ—á–∞—Ç–∫—É –≤–∏–≤—á–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ —Ç–µ–º–∏</p>
                            {% else %}
                                <h2 class="text-muted">‚ö™ –ù–æ–≤–∞ —Ç–µ–º–∞</h2>
                                <p class="text-muted small">–ì–æ—Ç–æ–≤–∏–π –ø–æ—á–∞—Ç–∏?</p>
                            {% endif %}
                        </div>

                        <div class="d-grid gap-2">
                            {% if skill.my_status == 'todo' %}
                                {% if skill.is_locked %}
                                    <button class="btn btn-secondary disabled" disabled>–í–∏–º–æ–≥–∏ –Ω–µ –≤–∏–∫–æ–Ω–∞–Ω—ñ</button>
                                {% else %}
                                    <a href="{% url 'change_status' skill.slug 'in_progress' %}" class="btn btn-primary btn-lg shadow-sm">üöÄ –ü–æ—á–∞—Ç–∏ –Ω–∞–≤—á–∞–Ω–Ω—è</a>
                                {% endif %}
                            {% elif skill.my_status == 'in_progress' %}
                                <a href="{% url 'change_status' skill.slug 'done' %}" class="btn btn-success btn-lg shadow-sm">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç–∏</a>
                            {% elif skill.my_status == 'done' %}
                                <a href="{% url 'change_status' skill.slug 'todo' %}" class="btn btn-outline-secondary btn-sm">–°–∫–∏–Ω—É—Ç–∏ –ø—Ä–æ–≥—Ä–µ—Å</a>
                            {% endif %}
                        </div>

                    {% else %}
                        <p class="mb-3">–£–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —Å–≤—ñ–π –ø—Ä–æ–≥—Ä–µ—Å –Ω–∞–≤—á–∞–Ω–Ω—è.</p>
                        <a href="{% url 'login' %}" class="btn btn-primary w-100">–£–≤—ñ–π—Ç–∏ –≤ –∞–∫–∞—É–Ω—Ç</a>
                    {% endif %}
                </div>
            </div>

            <div class="card shadow-sm">
                <div class="card-header bg-white fw-bold border-bottom">
                    –ö–∞—Ä—Ç–∞ –∑–Ω–∞–Ω—å
                </div>
                <ul class="list-group list-group-flush small">
                    {% if skill.requires.all %}
                        <li class="list-group-item bg-light text-muted fw-bold">–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ –≤–∏–º–æ–≥–∏:</li>
                        {% for req in skill.requires.all %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <a href="{% url 'skill_detail' req.from_skill.slug %}" class="text-decoration-none">
                                    {{ req.from_skill.title }}
                                </a>
                                {% if req.dependency_type == 'hard' %}
                                    <span class="badge bg-danger-subtle text-danger border border-danger-subtle">Required</span>
                                {% else %}
                                    <span class="badge bg-light text-dark border">Soft</span>
                                {% endif %}
                            </li>
                        {% endfor %}
                    {% endif %}

                    {% if skill.required_by.all %}
                        <li class="list-group-item bg-light text-muted fw-bold">–í—ñ–¥–∫—Ä–∏–≤–∞—î –¥–æ—Å—Ç—É–ø –¥–æ:</li>
                        {% for req in skill.required_by.all %}
                            <li class="list-group-item">
                                <a href="{% url 'skill_detail' req.to_skill.slug %}" class="text-decoration-none">
                                    {{ req.to_skill.title }}
                                </a>
                            </li>
                        {% endfor %}
                    {% endif %}
                </ul>
            </div>

        </div>
    </div>
{% endblock %}